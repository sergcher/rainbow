{% extends 'repair/repair_base.html' %}
{% load static %}

{% block css %}
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
    <link href="{% static 'css/apartment_base.css' %}" rel="stylesheet">
    <link href="{% static 'css/apartment.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
    <table class="apartment-table">
        <thead class="apartment-table">
            <tr>
                <th class="apartment-header">№</th>
                <th class="apartment-header">Список фамилий</th>
                <th class="apartment-header">Общ. площ.</th>
                <th class="apartment-header">Долг на начало месяца</th>
                <th class="apartment-header">Начислено</th>
                <th class="apartment-header">Пеня</th>
                <th class="apartment-header">Перерасчет</th>
                <th class="apartment-header">Оплачено</th>
                <th class="apartment-header">Итого</th>
            </tr>
        </thead>
        <tbody>
            {% for apartment in apartments %}
            <tr onclick="location.href='/repair/edit/{{ apartment.serialNumber }}';" style="cursor:pointer;">
                <td>
                    <span class="apartment-nomer">{{ apartment.serialNumber }}</span>
                </td>
                <td>
                    <span class="apartment-owner">{{ apartment.owner }}</span>
                </td>
                {% for detail in apartment.apartmentdetail_set.all %}
                    <td>{{ detail.totalArea }}</td>
                {% endfor %}
                {% for repair in apartment.capitalrepair_set.all %}
                    <td>{{ repair.debt }}</td>
                    <td>{{ repair.accrued }}</td>
                    <td>{{ repair.fine }}</td>
                    <td>{{ repair.recalculation }}</td>
                    <td>{{ repair.paid }}</td>
                    <td>{{ repair.total }}</td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>

<div class="back-to-top"></div>

<script>
    var backToTopButton = document.querySelector('.back-to-top');

    window.addEventListener('scroll', function() {
        if (window.pageYOffset > 100) {
            backToTopButton.style.display = 'block';
        } else {
            backToTopButton.style.display = 'none';
        }
    });

    backToTopButton.addEventListener('click', function() {
        window.scrollTo({
            top: 0,
            behavior: 'smooth'
        });
    });
</script>


<script>
  // get the filter select element
  const filterSelect = document.getElementById('filter');

  // get the current filter value from the query string
  const urlParams = new URLSearchParams(window.location.search);
  const currentFilter = urlParams.get('filter');

  // set the selected option in the filter select element based on the current filter value
  if (currentFilter === 'balance_end_gt_6000') {
    filterSelect.value = 'balance_end_gt_6000';
  }

  // add event listener to the filter select element
  filterSelect.addEventListener('change', function() {
    // get the selected option value
    const selectedValue = this.value;

    // construct the new URL based on the selected option value
    let newUrl = window.location.origin + window.location.pathname;
    if (selectedValue) {
      newUrl += '?filter=' + selectedValue;
    }

    // redirect to the new URL
    window.location.href = newUrl;
  });
</script>


{% endblock %}